<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popmotion/11.0.3/popmotion.js"
          integrity="sha512-LZjVmWj64loKzy6ANM2Mj5Yhw2Imu0u57wP/zZZ315WbiPi6CbyIvmXcCviNKYfJreEbnAnUBEfMBrjQxRpzRw=="
          crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pixi.js/4.3.5/pixi.js"></script>
  <style>
    body {
      margin: 0;
      padding: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
      background: black;
    }
  </style>
</head>
<body>
<script>
  (function () {
    "use strict";
    class Main {
      constructor() {
        this.NUM_PARTICLES = Number(location.href.split("?")[1]) || 1000;

        this.setupScreen();
        this.setupStage();
        this.setupParticles();

        //Start the game loop
        this.enterFrameHandler();
      }

      setupParticles() {

        var canvas = document.createElement("canvas");
        canvas.width = 1;
        canvas.height = 1;
        var ctx = canvas.getContext("2d");
        ctx.fillStyle = "#ffffff";
        ctx.fillRect(0, 0, 1, 1);

        var texture = PIXI.Texture.fromCanvas(canvas);

        var i = this.NUM_PARTICLES;
        while (--i >= 0) {

          const a = Math.random() * Math.PI * 2;
          const dx = Math.cos(a) * 400 * 1.4 + 300;
          const dy = Math.sin(a) * 400 * 1.4 + 400;

          const p = new PIXI.Sprite(texture);
          p.x = 400;
          p.y = 400;

          const sec = (1.5 + Math.random() * 4.5);

          popmotion.animate({
            from: {x:400, y:400},
            to: {x: dx, y: dy},
            repeat: Infinity,
            duration: sec * 1000,
            ease: popmotion.easeIn,
            onUpdate: (param) => {
              p.x = param.x;
              p.y = param.y;
            }
          });

          this.stage.addChild(p);
        }
      }

      setupScreen() {
        //Create a Pixi stage and renderer
        this.stage = new PIXI.Container();
        this.renderer = PIXI.autoDetectRenderer(800, 800);
        document.body.appendChild(this.renderer.view);
      }

      setupStage() {
      }

      enterFrameHandler(e) {
        requestAnimationFrame(() => {
          this.enterFrameHandler()
        });

        //Render the stage
        this.renderer.render(this.stage);
      }
    }


    window.addEventListener("DOMContentLoaded", () => {
      new Main();
    });


  })();
</script>
<script src="auto-stats.js"></script>
</body>
</html>
